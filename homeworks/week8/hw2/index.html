<!DOCTYPE html>
<html>
    <header>
        <title>歡迎來到王媽留言板</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" type="text/css" href="style.css" />
    </header>
    <body>
        <form class="msg__leave">
            <div class="msg__title">
                留言區
            </div>
            <textarea class="msg__text" type="text" ></textarea> 
            <input class="btn" type="button" value="提交" />
        </form>
        <div class="msg__board">
        </div>
        <script>
            const request = new XMLHttpRequest();
            const URL = "https://lidemy-book-store.herokuapp.com/posts"
            // 1 . 留言板功能
            const msgBoard = document.querySelector('.msg__board')
            const submit = document.querySelector('.btn')
            const msgText = document.querySelector('.msg__text')
            
           
            request.onload = function(){
                if (request.status >= 200 && request.status < 400) {
                const response = JSON.parse(request.responseText)
                    for ( let j = 0; j < response.length; j+=1) {
                    
                        const newMsgBlock = document.createElement('div')
                        newMsgBlock.classList.add('msg__block')

                        const newMsg = document.createElement('div')
                        newMsg.classList.add('msg__display')
                        newMsg.innerText = response[j].content
            
                        newMsgBlock.appendChild(newMsg)
                        msgBoard.appendChild(newMsgBlock)
                    }
                } else {
                    alert('網頁出了點問題，重新整理一下唷 ! ')
                }
            }

            request.open('GET',`${URL}?_limit=20&_sort=id&_order=desc`,true);
            request.send();
            //11111111111

            //2. 送出表單功能
            submit.addEventListener('click',function(){
                const msgObj = { content : msgText.value}
                const levelMsg = JSON.stringify(msgObj)
                request.open('POST',`${URL}`,true);
                request.setRequestHeader('Content-Type','application/json')
                request.send(levelMsg);
                msgText.value = ''
            })

            //22222222222
                
                
      
            
            
            
        </script>
    </body>
</html>
